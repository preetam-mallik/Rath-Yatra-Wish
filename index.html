<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ratha Yatra Shubhkamnayein</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gloock&family=Poppins:wght@400;500;700&family=Charm:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Theme (Default) */
            --bg-overlay: linear-gradient(rgba(255, 248, 225, 0.85), rgba(255, 248, 225, 0.9));
            --text-primary: #4A2511;
            --text-shayari: #F47B20;
            --text-greeting: #005B7F;
            --welcome-bg: linear-gradient(135deg, #FF9933, #FFC700);
            --welcome-text-color: #FFFFFF;
            --form-bg: rgba(255, 255, 255, 0.7);
            --form-border: 1px solid rgba(255, 255, 255, 0.5);
            --input-bg: #FFF8E1;
            --input-border: #4A2511;
            --input-focus: #FF9933;
            --btn-gradient: linear-gradient(45deg, #F47B20, #FF9933);
            --btn-shadow: 0 4px 15px rgba(244, 123, 32, 0.2);
            --btn-shadow-hover: 0 8px 25px rgba(244, 123, 32, 0.3);
            --body-bg: #4A2511;
            --rath-base: #4A2511;
            --shayari-glow1: rgba(255, 199, 0, 0.7);
            --shayari-glow2: rgba(255, 153, 51, 0.7);
            --shayari-glow3: rgba(244, 123, 32, 0.5);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* Dark Theme Overrides */
                --bg-overlay: linear-gradient(rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 0.9));
                --text-primary: #f0f0f0;
                --text-shayari: #FF9933;
                --text-greeting: #f0f0f0;
                --welcome-bg: linear-gradient(135deg, #111, #000);
                --welcome-text-color: #FF9933;
                --form-bg: rgba(44, 44, 44, 0.7);
                --form-border: 1px solid rgba(255, 255, 255, 0.1);
                --input-bg: #2c2c2c;
                --input-border: #555;
                --input-focus: #FF9933;
                --btn-shadow: 0 4px 15px rgba(255, 153, 51, 0.2);
                --btn-shadow-hover: 0 8px 25px rgba(255, 153, 51, 0.3);
                --body-bg: #1a1a1a;
                --rath-base: #2c2c2c;
                --shayari-glow1: rgba(255, 153, 51, 0.8);
                --shayari-glow2: rgba(255, 153, 51, 0.6);
                --shayari-glow3: rgba(244, 123, 32, 0.4);
            }
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { height: 100%; }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--body-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            height: 100svh;
            overflow: hidden; /* This is crucial for no-scroll */
        }

        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--welcome-bg); z-index: 100; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-in-out, visibility 0.8s;
            text-align: center;
        }
        #welcome-screen.hidden { opacity: 0; visibility: hidden; }
        .welcome-text {
            font-family: 'Gloock', serif; font-size: clamp(3rem, 15vw, 6rem);
            color: var(--welcome-text-color); text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: pop-in 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        .welcome-subtext {
            font-size: clamp(1rem, 5vw, 1.5rem); color: var(--text-primary);
            margin-top: 20px; padding: 0 20px;
        }
        #welcome-subtext-action {
             font-size: clamp(0.9rem, 4vw, 1.2rem); color: var(--text-primary);
             margin-top: 10px; opacity: 0; animation: fade-in 1s ease-in-out 1s forwards;
             font-weight: bold;
        }
        @keyframes pop-in { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        .card-container {
            width: 100vw; height: 100vh; height: 100svh;
            position: relative;
            display: flex; flex-direction: column; transition: background 0.5s ease-in-out;
            padding: 2.5vh 25px;
            /* UPDATED: Background now points to your local file 'jaganath.gif' */
            background-image: var(--bg-overlay), url('jaganath.gif'), url('jaganath.gif');
            background-size: cover, auto, cover;
            background-position: center, center, center;
            background-repeat: no-repeat, repeat, no-repeat;
        }
        
        .content-wrapper {
            position: relative; z-index: 1; text-align: center;
            flex-grow: 1; /* Key for layout */
            display: flex; flex-direction: column;
            justify-content: space-around; /* Distributes space evenly */
            min-height: 0; /* Important for flex children to shrink */
        }
        
        .main-image {
            width: 100%; max-width: clamp(100px, 22vh, 180px); height: auto;
            border-radius: 50%; box-shadow: 0 0 25px rgba(255, 153, 51, 0.5);
            border: 4px solid var(--brand-gold); margin: 0 auto;
            background: linear-gradient(145deg, #ffffff20, #00000020);
            flex-shrink: 0;
        }
        
        .greeting-text {
            font-family: 'Gloock', serif; font-size: clamp(1.8rem, 7vw, 3rem); line-height: 1.2;
            color: var(--text-greeting);
            padding: 1vh 0;
        }
        
        .shayari-text {
            font-family: 'Charm', cursive; font-weight: 700; font-size: clamp(1rem, 3.8vw, 1.5rem); 
            line-height: 1.6; color: var(--text-shayari); margin: 0 5px; white-space: pre-wrap;
            text-shadow: 0 0 8px var(--shayari-glow1), 0 0 15px var(--shayari-glow2), 0 0 25px var(--shayari-glow3);
            animation: text-glow 2.5s infinite alternate;
            overflow-y: auto; /* Allow shayari to scroll if it's too long */
            max-height: 25vh; /* Limit the max height of shayari */
        }
        @keyframes text-glow {
            from { text-shadow: 0 0 8px var(--shayari-glow1), 0 0 15px var(--shayari-glow2), 0 0 25px var(--shayari-glow3); }
            to   { text-shadow: 0 0 15px var(--shayari-glow1), 0 0 30px var(--shayari-glow2), 0 0 50px var(--shayari-glow3); }
        }

        .rath-container { max-width: clamp(200px, 30vw, 250px); margin: 1vh auto; position: relative; flex-shrink: 0;}
        .rath { width: 100%; height: auto; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
        .wheel { position: absolute; width: 15%; animation: rotate 10s linear infinite; }
        .wheel-left { bottom: 18%; left: 22%; }
        .wheel-right { bottom: 18%; right: 22%; }
        
        .form-wrapper {
            flex-shrink: 0; /* Prevents this container from shrinking */
            padding-top: 2vh;
        }
        .form-container {
            background: var(--form-bg); border-radius: 20px; padding: clamp(15px, 3vw, 20px); 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); width: 100%; max-width: 380px; margin: 0 auto;
            backdrop-filter: blur(8px); border: var(--form-border);
        }
        
        .form-title {
            font-family: 'Gloock', serif; color: var(--text-primary); margin-bottom: 15px;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
        }
        
        .form-group { margin-bottom: 10px; }
        
        input {
            width: 100%; padding: 12px 16px; border: 1px solid var(--input-border);
            border-radius: 12px; font-size: clamp(0.9rem, 3.5vw, 1rem); font-family: 'Poppins', sans-serif;
            background: var(--input-bg); color: var(--text-primary);
        }
        input:focus { outline: 2px solid var(--input-focus); border-color: var(--input-focus); }

        .primary-btn {
            background: var(--btn-gradient); color: var(--brand-white); border: none;
            padding: 12px 20px; border-radius: 100px; font-size: clamp(0.9rem, 3.8vw, 1rem); font-weight: 700;
            cursor: pointer; transition: all 0.3s ease; box-shadow: var(--btn-shadow); 
            width: 100%; margin-top: 10px; display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .primary-btn:hover { transform: translateY(-3px); box-shadow: var(--btn-shadow-hover); }
        .primary-btn svg { width: 1em; height: 1em;}
        
        .audio-control { position: absolute; top: 20px; right: 20px; z-index: 100; }
        .mute-btn {
            background: rgba(0,0,0,0.3); border-radius: 50%; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-light); cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(5px);
        }
        .mute-btn:hover { transform: scale(1.1); }
        .mute-btn svg { width: 22px; height: 22px; fill: white; }
        
        footer { padding-top: 2vh; font-size: clamp(0.8rem, 3vw, 0.9rem); color: var(--text-primary); opacity: 0.7; }
        
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="welcome-screen">
        <div class="welcome-text">Jai Jagannath</div>
        <div class="welcome-subtext" id="welcomeUserText"></div>
        <div class="welcome-subtext" id="welcome-subtext-action">Loading...</div>
    </div>

    <div class="card-container">
        <div class="audio-control"><div class="mute-btn" id="muteBtn"></div></div>
        
        <div class="content-wrapper">
            <header>
                <img src="jaganath.gif" alt="Jai Jagannath" class="main-image" onerror="this.src='https://placehold.co/500x500/1a1a1a/FF9933?text=Jai+Jagannath'; this.onerror=null;">
            </header>
            
            <div class="main-content">
                <h1 class="greeting-text" id="greetingText">Happy Ratha Yatra!</h1>
                <h2 class="shayari-text" id="shayariText"></h2>
            </div>
            
            <div class="rath-animation">
                <div class="rath-container">
                    <svg class="rath" viewBox="0 0 600 300" xmlns="http://www.w3.org/2000/svg"><rect x="100" y="120" width="400" height="60" fill="var(--rath-base)" rx="5"/><rect x="90" y="100" width="420" height="20" fill="#d32f2f" rx="5"/><rect x="150" y="40" width="300" height="80" fill="#F47B20" rx="5"/><rect x="140" y="30" width="320" height="10" fill="#d32f2f"/><rect x="180" y="20" width="40" height="10" fill="#FFD700"/><rect x="280" y="20" width="40" height="10" fill="#FFD700"/><rect x="380" y="20" width="40" height="10" fill="#FFD700"/><rect x="170" y="50" width="20" height="50" fill="var(--rath-base)"/><rect x="410" y="50" width="20" height="50" fill="var(--rath-base)"/><path d="M170,30 Q160,10 150,30 L170,30" fill="#d32f2f"/><path d="M410,30 Q400,10 390,30 L410,30" fill="#d32f2f"/></svg>
                    <svg class="wheel wheel-left" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="var(--rath-base)" stroke="#FFD700" stroke-width="5"/><circle cx="50" cy="50" r="10" fill="#FFD700"/><line x1="50" y1="10" x2="50" y2="90" stroke="#FFD700" stroke-width="4"/><line x1="10" y1="50" x2="90" y2="50" stroke="#FFD700" stroke-width="4"/><line x1="20" y1="20" x2="80" y2="80" stroke="#FFD700" stroke-width="4"/><line x1="80" y1="20" x2="20" y2="80" stroke="#FFD700" stroke-width="4"/></svg>
                    <svg class="wheel wheel-right" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="var(--rath-base)" stroke="#FFD700" stroke-width="5"/><circle cx="50" cy="50" r="10" fill="#FFD700"/><line x1="50" y1="10" x2="50" y2="90" stroke="#FFD700" stroke-width="4"/><line x1="10" y1="50" x2="90" y2="50" stroke="#FFD700" stroke-width="4"/><line x1="20" y1="20" x2="80" y2="80" stroke="#FFD700" stroke-width="4"/><line x1="80" y1="20" x2="20" y2="80" stroke="#FFD700" stroke-width="4"/></svg>
                </div>
            </div>
            
            <div class="form-wrapper" id="formWrapper">
                 <div class="form-container">
                    <h2 class="form-title">Apno ko Shubhkamnayein Bhejein</h2>
                    <form id="greetingForm">
                        <div class="form-group"><input type="text" id="friendName" placeholder="Dost ka Naam Likhein..." required></div>
                        <button type="submit" class="primary-btn" id="shareBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                            Share on WhatsApp
                        </button>
                    </form>
                </div>
                 <footer id="footer"><p>Jai Jagannath!</p></footer>
            </div>
        </div>
    </div>
    
    <audio id="bgAudio" loop><source src="Rath.mp3" type="audio/mpeg"></audio>
    <audio id="ttsAudio"></audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ELEVENLABS_API_KEY = "sk_f970e64108f616aa590a1ff230a19be599c9b860b9bf7b0a";
            const VOICE_ID = 'kL06KYMvPY56NluIQ72m';
            let ttsPlayedOnce = false;

            const shayaris = ["Jagannath ka ho ashirwad sada,\nRahe jeevan mein khushiyo ki ada,\nHar mod pe ho unnati ka raag,\nRatha Yatra laaye sukh aur bhaag.", "Rath chadhe to mann mein ho shanti,\nJagannath ji ki ho kirti ati,\nDukh mit jaye unke naam se,\nKhushbu aaye har ek kaam se.", "Jagannath ka ho pyar hamesha,\nMann rahe pavitra aur nirmal jaisa,\nCharo disha ho roshan tera,\nRatha Yatra laaye sukh ka savera.", "Bhai-bahan ka ho rishta gehra,\nJagannath ka ho pyaar sabse pehla,\nManzil ho roshan, raah ho saaf,\nRatha Yatra laaye jeevan mein raah.", "Charo disha mein goonj rahi hai,\nJagannath ke naam ki baaje bansi hai,\nHar man mein ho unka vasa,\nRatha Yatra laaye khushiyo ka jalsa.", "Rath ke saath chalo prem ki raah,\nJagannath dein tumhe sukh aur chaah,\nHar pal ho bhakti se bhara,\nTumhara jeevan bane ek sundar tara.", "Jagannath ka naam lo, dukh mita do,\nMan ko pavitra bana do,\nBhakti mein doob jao is din,\nRatha Yatra mein khud ko kho do.", "Ratha Yatra ka pawan samay hai aaya,\nBhakti ka rang har dil mein chhaya,\nJagannath ka ho tum par karam,\nHar din bane ek naya sanmarg.", "Dil mein ho shraddha, aankhon mein vishwas,\nJagannath dein tumhe har sukh ki aas,\nRatha Yatra ka tyohar ho shubh,\nTumhara jeevan bane ek anupam subh.", "Rath ke pahiye le aaye barkat,\nBhakti ki ho sada tummein chahat,\nJagannath rakhein tumhara dhyaan,\nHar mushkil ho jaaye aasaan.", "Prem aur bhakti se bhara ho jeevan,\nRatha Yatra laaye naye sapnon ka manthan,\nJagannath ka ho tum par ashirwad,\nMile har mod pe tumhe khushiyo ka saath.", "Chalo us rath ke peeche jahan ho shanti,\nJagannath ke darshan se mile pavitrata ki bhanti,\nRatha Yatra ho tumhara utsav,\nHar din ho jeevan mein ek naya pravah.", "Jagannath ke charno mein mile vishraam,\nDil se nikle bas unka naam,\nRatha Yatra ka din ho mangalmay,\nTumhare jeevan mein aaye ek naya uday.", "Bhole Jagannath ka ho tum par pyaar,\nRahe sada khushiyon ka sansar,\nRatha Yatra mein ho bhakti ka rang,\nMann mein bajti rahe unki sang.", "Jai Jagannath ho sabke zubaan par,\nRatha Yatra ho jeevan mein utsav har baar,\nDukhon se ho mukti sabhi ko,\nPrem ho har rishte ki jadoo.", "Rath chal pada bhakti ke raaste,\nJagannath milte sab ke vaaste,\nIss din tum bhi jeevan sudharo,\nRatha Yatra se prem ka geet utaro.", "Ratha Yatra ho jeevan ki raah,\nJagannath dein tumhe har chaah,\nHar dard ho door unke naam se,\nJeevan mein aaye sukh har kaam se.", "Jagannath ke darshan ka sukh mile,\nHar pal unki kirti mein man jeele,\nRatha Yatra ka paawan avsar hai,\nHar dil mein unka basera ho yeh arman hai.", "Mandir ki ghanti ho ya rath ki pukar,\nJagannath ka ho tum par pyaar,\nRatha Yatra laaye barkat hazaar,\nMile tumhe har sukh bepanah pyar.", "Bhakti mein jise kho jaye jeevan,\nRatha Yatra ho uska sangrah visheshan,\nJagannath ka ho ashirwad sada,\nRahe jeevan mein sukhon ki ada.", "Ratha Yatra aaye jeevan mein rang,\nJagannath se jure har ek sang,\nPrem aur shanti ho har pal mein,\nTum sada raho unke charan mein.", "Charo or ho bhakti ka vaataavaran,\nJagannath ho har pal ka sahyog,\nRatha Yatra ka din laaye sukh,\nTumhare har sapne ho poore anuyog.", "Jagannath ka ho tum par vishesh kripa,\nMile tumhe har pal mein nayi prerna,\nRatha Yatra ho tumhare jeevan ka geet,\nJahan ho prem, bhakti aur meet.", "Utsav ho ya tyohar, unka ho pyaar,\nRatha Yatra mein ho sukh apaar,\nJagannath ka naam lo har baar,\nJeevan mein aaye anek uphaar.", "Chal rahi hai rath yatra ki dor,\nJagannath aayein khushiyan chor-chor,\nRaho sada unke saath,\nHar din ho bhakti ki baat.", "Ratha Yatra ke din ho nayi soch,\nJagannath ka naam ho har morh,\nJeene ka mil jaye ek naya tor,\nKhushiyo ka ho sabko ghoor.", "Prem ki baat ho, bhakti ki raah,\nJagannath se jud jaaye har chaah,\nRatha Yatra mein ho anand ka saath,\nMann mein bajti rahe unki baansuri raat-din.", "Rath chala bhakti ke marg pe,\nJagannath milein har pal ke sang pe,\nTum bhi jud jao iss pavitr yatra se,\nRaho sada unki kripa ki chhaya mein.", "Jagannath ho tumhare rakhwale,\nHar mushkil ko kardein hawale,\nRatha Yatra ka yeh paavan din,\nLaaye tumhare jeevan mein sundar rin.", "Jagannath ki ho mahima apar,\nRatha Yatra banaye tumhara sansar,\nDukh na aaye tumhare paas,\nHar pal ho prem, bhakti aur vishwas."];
            
            const welcomeScreen = document.getElementById('welcome-screen');
            const welcomeUserText = document.getElementById('welcomeUserText');
            const welcomeActionText = document.getElementById('welcome-subtext-action');
            const urlParams = new URLSearchParams(window.location.search);
            const friendName = urlParams.get('name');
            const greetingText = document.getElementById('greetingText');
            const shayariText = document.getElementById('shayariText');
            const formWrapper = document.getElementById('formWrapper');
            const bgAudio = document.getElementById('bgAudio');
            const ttsAudio = document.getElementById('ttsAudio');
            const muteBtn = document.getElementById('muteBtn');

            if (friendName) {
                welcomeUserText.textContent = `${decodeURIComponent(friendName)} ne aapke liye ek sandesh bheja hai`;
                greetingText.textContent = `Happy Ratha Yatra, ${decodeURIComponent(friendName)}!`;
            } else {
                welcomeUserText.textContent = "Aapke liye ek sandesh hai";
                greetingText.textContent = 'Happy Ratha Yatra!';
            }
            
            const randomIndex = Math.floor(Math.random() * shayaris.length);
            shayariText.textContent = shayaris[randomIndex];
            
            const textToSpeak = `${greetingText.textContent}. ${shayariText.textContent.replace(/\n/g, ' ')}`;

            async function prepareGreetingSpeech(text) {
                if (!text || !ELEVENLABS_API_KEY) {
                    onAudioReady(); 
                    return;
                }
                const url = `https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}?optimize_streaming_latency=1`;
                const headers = { "Accept": "audio/mpeg", "Content-Type": "application/json", "xi-api-key": ELEVENLABS_API_KEY };
                const data = { "text": text, "model_id": "eleven_multilingual_v2", "voice_settings": { "stability": 0.5, "similarity_boost": 0.75 } };
                try {
                    const response = await fetch(url, { method: 'POST', headers: headers, body: JSON.stringify(data) });
                    if (!response.ok) throw new Error("API Error");
                    const audioBlob = await response.blob();
                    ttsAudio.src = URL.createObjectURL(audioBlob);
                    ttsAudio.addEventListener('canplaythrough', onAudioReady, { once: true });
                    setTimeout(onAudioReady, 5000); 
                    ttsAudio.load();
                } catch (error) {
                    console.error("TTS Error:", error);
                    onAudioReady(); 
                }
            }
            
            let audioIsReady = false;
            function onAudioReady() {
                if(audioIsReady) return; 
                audioIsReady = true;
                welcomeActionText.textContent = 'Tap to Continue';
                welcomeScreen.style.cursor = 'pointer';
            }

            prepareGreetingSpeech(textToSpeak);

            const unmuteIcon = '<svg viewBox="0 0 24 24" fill="white"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zM16.5 12c0-1.77-1-3.29-2.5-4.03v8.05c1.5-0.74 2.5-2.26 2.5-4.02zM3 9v6h4l5 5V4L7 9H3z"></path></svg>';
            const muteIcon = '<svg viewBox="0 0 24 24" fill="white"><path d="M4.34 2.93L2.93 4.34 7.29 8.7 7 9H3v6h4l5 5v-6.59l4.18 4.18c-.65.49-1.38.88-2.18 1.11v2.06c1.34-.3 2.57-.92 3.61-1.75l2.05 2.05 1.41-1.41L4.34 2.93zM19 12c0 .82-.15 1.61-.41 2.34l1.53 1.53c.56-1.17.88-2.48.88-3.87 0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zm-7-8l-1.88 1.88L12 7.41V4h-1z"></path></svg>';
            let isMuted = true;
            muteBtn.innerHTML = muteIcon;

            const startExperience = () => {
                welcomeScreen.classList.add('hidden');
                isMuted = false;
                muteBtn.innerHTML = unmuteIcon;
                bgAudio.play().catch(e => {});
                if (ttsAudio.src && !ttsPlayedOnce && audioIsReady) {
                    ttsPlayedOnce = true;
                    bgAudio.volume = 0.1;
                    ttsAudio.play().catch(e => {});
                    ttsAudio.onended = () => { if (!isMuted) bgAudio.volume = 0.5; };
                }
            };
            
            welcomeScreen.addEventListener('click', startExperience, { once: true });


            muteBtn.addEventListener('click', function(event) {
                event.stopPropagation();
                isMuted = !isMuted;
                muteBtn.innerHTML = isMuted ? muteIcon : unmuteIcon;
                if (isMuted) { bgAudio.pause(); ttsAudio.pause(); } 
                else {
                    bgAudio.play().catch(e => {});
                    if (ttsAudio.paused && ttsAudio.currentTime > 0 && !ttsAudio.ended) {
                       ttsAudio.play().catch(e => {});
                    }
                }
            });
            
            const form = document.getElementById('greetingForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const newFriendName = document.getElementById('friendName').value;
                    if (!newFriendName.trim()) return;
                    const currentUrl = window.location.href.split('?')[0];
                    const newUrl = `${currentUrl}?name=${encodeURIComponent(newFriendName)}`;
                    const whatsappMessage = `Jai Jagannath! 🙏 मैंने आपके लिए एक special Ratha Yatra greeting बनाया है। देखने के लिए नीचे दिए गए लिंक पर क्लिक करें:\n\n${newUrl}`;
                    const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(whatsappMessage)}`;
                    window.open(whatsappUrl, '_blank');
                });
            }
        });
    </script>
</body>
</html>